\documentclass{article}
\usepackage{mathtools}
\usepackage{harpoon}
\usepackage{amsfonts}

\makeatletter
\newcommand{\tpmod}[1]{{\@displayfalse\pmod{#1}}}
\makeatother

\begin{document}
\title{Introduction to Modern Cryptography - EX. 5}
\author{Roi Koren 305428369\\ Noam Koren 204175004}
\date{\today}
\pagenumbering{gobble}
\maketitle
\newpage
\pagenumbering{roman}

\section{Commitments}
\begin{paragraph}
    a Even if computationally-unbounded, Bob can learn nothing about $s$.
    Since $g_2$ is a generator in $\mathbb{G}$, for each $s$ exists $r$ s.t. $g_2^r = hg_1^{-s}$.
    From this it follows that given $C$, Bob can only see a random value, hence learning nothing.
\end{paragraph}

\begin{paragraph}
    b Alice can't change $s$ without Bob noticing. Assume by contradiction that she can, i.e. Alice
    can calculate $s', r'$ s.t. $comm_r(s) = comm_{r'}(s') \Rightarrow g_1^sg_2^r = g_1^{s'}g_2^{r'} \Rightarrow
    g_1 = g_2^\frac{r' - r}{s - s'}$. This is in contradiction to the assumption that DLOG is hard in $\mathbb{G}$.
    Of course, if Alice is computationally-unbounded she can calculate $t$ s.t. $g_1 = g_2^t$ and switch
    the value of $(s, r)$ to $(s', r')$ while keeping that $t = \frac{r' - r}{s - s'}$.
\end{paragraph}

\begin{paragraph}
    c Checking if $p, q$ are primes of length larger then 512 bits is trivial, and that $p = 2q + 1$.
    To check if $g_1, g_2 \in \mathbb{Z}^*_p$ are of order $q$, since $\varphi(p) = 2q$, it is suffice to check that
    $g_{1,2}^q = 1\tpmod p$ and $g_{1,2}^2 \neq 1 \tpmod p$.
\end{paragraph}

\begin{paragraph}
    d Alice can indeed cheat, given the ability to cheat the scheme's parameters.
    Alice can choose $g_1, g_2$ s.t. $g_1 = g_2^t$. If after publishing a commitment $comm_r(s) = C = g_1^sg_2^r \tpmod p$,
    she would like to reveal $(s', r')$ instead of $(s, r)$, she can calculate $r' = r + t(s - s')$. And indeed, Bob will 
    calculate $C' = g_1^{s'}g_2^{r'} = g_1^{s'}g_2^{r + t(s-s')} = g_1^{s'}g_2^{t(s-s')}g_2^r = g_1^sg_2^r = C$.
\end{paragraph}

\begin{paragraph}
    e As we've seen in section a, Bob learns nothing of $s$ from $C$. This is true for every set of parameters. Thereby, Bob
    can not cheat.
\end{paragraph}

\begin{paragraph}
    f As a result of the previous two sections, letting Bob choose the parameters will keep the protocol secure.
\end{paragraph}

\section{ZK}
\begin{paragraph}
    a Bob accepts iff\\
    
    \quad if \(b = 0\), for all \(j \in \{1, ..., n\}\), \(C(i, j) = Com(K(i, j), S(i, j))\) and also \(\exists k \in \{1, ..., n\}\) s.t. \(S(i, k) = j\). This would mean that the commitments hadn't changed, and that each number between 1 and \(n\) appears (exactly once) in \(V\).
    
    \quad if \(b = 1\), for all \(j \in \{1, ..., n\}\), \(C(j, i) = Com(K(j, i), S(j, i))\) and also \(\exists k \in \{1, ..., n\}\) s.t. \(S(k, i) = j\). This again would mean that the commitments hadn't changed, and that each number between 1 and \(n\) appears (exactly once) in \(V\).
    
    \quad if \(b = 2\), \(\pi\) is a permutation, and for each sent key \(K(\pi(i), \pi(j))\) it is true that \(C(\pi(i), \pi(j)) = Com(K(\pi(i), \pi(j)), M(i, j))\). This would mean that all of the non-empty cells of \(M\) hadn't changed.
\end{paragraph}

\begin{paragraph}
    b Bob sees a random looking \(n \times n\) matrix, \(b\) and \(i\) picked according to his internal randomness, and Alice's response, which changes according to \(b\). If \(b = 0\) or \(b = 1\), he sees \(V\), a random permutation of \(\{1, ..., n\}\), and \(n\) random keys. Otherwise, he sees a random key for each non-empty cell of \(M\), as well as the cell itself.
    
    To simulate Bob's view, choose a random permutation \(\pi\) and pick \(b, i\) according to Bob's internal randomness. If \(b = 0\), assign \(V(j) = \pi(j)\) for each of \(j \in \{1, ..., n\}\). Next, pick \(n\) random keys \(K(1), ..., K(n)\), use these keys to calculate \(C(i, j) = Com(K(j), V(j))\), and fill the rest of \(C\) with random elements, from the same domain as the elements in the non-empty cells. If \(b = 1\), do the same, except this time set \(C(j, i) = Com(K(j), V(j))\), with the rest of \(C\) again chosen at random. If \(b = 2\), for each non-empty cell \((i, j)\) of \(M\), pick a random key \(K(i, j)\), and set \(C(\pi(i), \pi(j)) = Com(K(i, j), M(i, j))\), and, again, fill the rest of \(C\) with random elements from the same domain.
\end{paragraph}

\begin{paragraph}
    c Assume \(M\) isn't good. This means that for every \(T\) that Alice can create, s.t. for each non-empty cell \((i, j)\) of \(M\), \(M(i, j) = T(i, j)\), at least two of the rows and columns of \(T\) do not contain all of the numbers in \(\{1, ..., n\}\). Assume exactly one row and one column are "bad". Then, if Bob picks \(b = 0\) or \(b = 1\), he has a 1 in \(n\) chance of selecting that row or column. So the odds of him catching Alice in a lie are at least \(\frac{2}{3} \cdot \frac{1}{n} = \frac{2}{3n}\). If Alice chooses a matrix \(T\) that does not match \(M\) in at least one of \(M\)'s non-empty cells, if Bob picks \(b = 2\) he will catch Alice's lie, meaning his odds of doing so are \(\frac{1}{3}\). This would mean that Bob's odds of catching Alice's lie are at least \(\min\{\frac{2}{3n}, \frac{1}{3}\}\).
\end{paragraph}

\section{ZK with QR}
\begin{paragraph}
    a 
\end{paragraph}

\section{Coin tossing}
\begin{paragraph}
    a Assume Bob and Alice are honest. We know that \(\mathbb{Z}^*_m\) is isomorphic to \(\mathbb{Z}^*_p \times \mathbb{Z}^*_q\). Knowing \(p, q\), and given \(y = x^2\) for some \(x \in \mathbb{Z}^*_m\), Alice can find the appropriate pair \((y \mod{p}, y \mod{q})\), and find the square roots of these two efficiently. Alice must now choose one of the 4 possible square roots of \(y\) in \(\mathbb{Z}^*_m\), depending on her choice of the negative or positive root for each of \(y \mod{p}, y \mod{q}\). Since both \(x\) and \(-x\) are square roots of \(y\), Alice's odds of guessing a root \(x'\) s.t. \(|x'| = |x|\) are \(\frac{2}{4} = \frac{1}{2}\). Therefor the probability that Alice will pay is exactly \(\frac{1}{2}\).
\end{paragraph}

\begin{paragraph}
    b Assume that indeed \(m = pq\) for \(p, q\) primes. Alice cannot cheat Bob, even if she is computationally unbounded, since as we've seen in the previous sub-section, there are exactly 4 square roots of \(y = x^2\), for some \(x \in \mathbb{Z}^*_m\), two of which are \(x, -x\). Meaning Alice still has to guess which root Bob picked, and as we've seen the odds of that happening are \(\frac{1}{2}\).
\end{paragraph}

\begin{paragraph}
    c A computationally bounded Bob cannot cheat Alice, since he has no efficient way of finding the roots of \(y\), as we assumed factorization is hard. This means that If he chooses \(x \in \mathbb{Z}^*_m\), and Alice guesses \(x\) (or \(-x\)), Bob cannot efficiently find a different root of \(y\). He can, if Alice does indeed guess \(x\) (or \(-x\)), simply guess \(x' \in \mathbb{Z}^*_m\), and hope that it is also a square root of \(y\), but the odds of that are extremely low.
    
    If Bob is computationally unbounded, he can calculate all 4 square roots of \(y\) in \(\mathbb{Z}^*_m\), and reveal one of the square roots that lead to him not paying, after Alice reveals her guess.
\end{paragraph}

\begin{paragraph}
    d Alice cannot cheat Bob in this scenario. She only responds to Bob's \(y\), and each time must guess between the four possible roots, which she can easily calculate. Thus she does not gain any new information about Bob's pick of \(x\), regardless of how many times the two of them repeat steps 2 through 4.
    
    Bob can cheat Alice. If Alice does not win in any of the first two rounds, Bob wins the game. Otherwise, assume Alice won in one of those rounds, when Bob picked \(x \in \mathbb{Z}^*_m\) and sent her \(y = x^2\), and Alice sent back some \(x' \in \mathbb{Z}^*_m\) s.t. \(x'^2 = y, |x'| \neq |x|\), Bob now knows all four roots of \(y\), namely \(x, -x, x', -x'\). If Bob send Alice \(y\) again, he can choose a root that will lead to him winning this round. Thus Bob can win w.p. 1 - if he wins the first two rounds, he wins, otherwise he can win all rounds after his first loss, and win again.
\end{paragraph}

\section{Coin tossing with QR}
\begin{paragraph}
    a 
\end{paragraph}

\end{document}
